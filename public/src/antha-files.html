<script src="https://cdn.rawgit.com/download/polymer-cdn/1.4.0.2/lib/webcomponentsjs/webcomponents-lite.js"></script>
<link rel="import" href="https://cdn.rawgit.com/download/polymer-cdn/1.4.0.2/lib/polymer/polymer.html">
<link rel="import" href="https://cdn.rawgit.com/download/polymer-cdn/1.4.0.2/lib/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="https://cdn.rawgit.com/download/polymer-cdn/1.4.0.2/lib/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="https://cdn.rawgit.com/download/polymer-cdn/1.4.0.2/lib/iron-list/iron-list.html">

<link rel="import" href="https://cdn.rawgit.com/download/polymer-cdn/1.4.0.2/lib/paper-styles/color.html">
<link rel="import" href="https://cdn.rawgit.com/download/polymer-cdn/1.4.0.2/lib/paper-styles/typography.html">
<link rel="import" href="https://cdn.rawgit.com/download/polymer-cdn/1.4.0.2/lib/paper-styles/shadow.html">
<link rel="import" href="https://cdn.rawgit.com/download/polymer-cdn/1.4.0.2/lib/paper-styles/default-theme.html">

<dom-module id="antha-files">
  <style is="custom-style" include="iron-flex iron-flex-reverse iron-flex-alignment iron-flex-factors iron-positioning">
    :host {
      @apply(--section);
    }
    .file {

    }
  </style>
  <template>
    <iron-list items="{{files}}" as="item" grid>
      <template>
        <div class="file">
          <b>[[item.name]]</b>
          <p>[[_fileSummary(item.content)]]</p>
        </div>
      </template>
    </iron-list>
  </template>
  <script>
Polymer({
  is: 'antha-files',
  properties: {
    files: {
      type: Array,
      value: () => {
        return [];
      },
      notify: true
    },
    fileSelected: {
      type: Object,
      notify: true,
      observer: '_watchFileSelected'
    }
  },
  _fileSummary: function(content) {
    if (content) {
      return content.substr(0, 50);
    }
  },
  _watchFileSelected: function(file) {

  },
  _selectionHandler: function(file) {
    // When file has been selectd
    if (file) {

    }
  },
  ready: function() {
    // Make into an Array then do Promise.all(...)
    var filesToFetch = ['/public/examples/typeiisconstructassembly_sim.an'];
    var fileToFetch = filesToFetch[0];
      fetch(fileToFetch).then((res) => {
        return res.text();
      }).then((file) => {
        // harcoding for now - use the index to determine name of the file
        this.set('fileSelected.name', 'examples/typeiisconstructassembly_sim.an');
        this.set('fileSelected.content', file);

        // Remove 2nd - just for testing
        this.push('files', this.fileSelected, this.fileSelected);

        //this.push('files', { name: '11', content: '22'}, { name: '33', content: '444'});
        // Hack:
        // Resizing

        // iron-list lays out the items when it receives a notification via the iron-resize event. This event is fired by any element that implements IronResizableBehavior.

        // By default, elements such as iron-pages, paper-tabs or paper-dialog will trigger this event automatically. If you hide the list manually (e.g. you use display: none) you might want to implement IronResizableBehavior or fire this event manually right after the list became visible again. For example:

        document.querySelector('iron-list').fire('iron-resize');
      });
  }
});
  </script>
</dom-module>